# Models System Schema - RAG-style configuration
# Version: 2.0.0
# Schema: draft-07
$schema: http://json-schema.org/draft-07/schema#

title: Models System Configuration Schema
description: Comprehensive schema for model management, fine-tuning, and deployment strategies
version: 2.0.0

type: object
properties:
  # =====================================
  # STRATEGIES - Top-level strategy definitions
  # =====================================
  strategies:
    type: array
    description: List of named strategy configurations combining components for specific use cases
    items:
      type: object
      required: [name, description, components]
      properties:
        name:
          type: string
          description: Human-readable strategy name
          
        description:
          type: string
          description: Detailed description of strategy purpose and use case
          
        components:
          type: object
          description: Component configuration for this strategy
          properties:
            cloud_api:
              type: object
              properties:
                type:
                  type: string
                  enum: [openai_compatible, anthropic, custom]
                config:
                  type: object
                  
            model_app:
              type: object
              properties:
                type:
                  type: string
                  enum: [ollama, llamacpp, vllm, custom]
                config:
                  type: object
                  
            fine_tuner:
              type: object
              properties:
                type:
                  type: string
                  enum: [pytorch, llamafactory, custom]
                config:
                  type: object
                  
            repository:
              type: object
              properties:
                type:
                  type: string
                  enum: [huggingface, modelscope, custom]
                config:
                  type: object
                  
            image_recognizer:
              type: object
              description: Image recognition and computer vision component
              properties:
                type:
                  type: string
                  enum: [yolo, opencv, tensorflow, pytorch_vision, custom]
                config:
                  type: object
                  description: Configuration specific to the image recognizer type
                  
            image_trainer:
              type: object
              description: Image model training component
              properties:
                type:
                  type: string
                  enum: [yolo_trainer, few_shot_trainer, pytorch_trainer, custom]
                config:
                  type: object
                  description: Configuration specific to the image trainer type
                  
        fallback_chain:
          type: array
          description: Ordered list of fallback options
          items:
            type: object
            properties:
              name:
                type: string
              type:
                type: string
              config:
                type: object
                
        routing_rules:
          type: array
          description: Conditional routing based on input characteristics
          items:
            type: object
            properties:
              condition:
                type: string
              target:
                type: string
              priority:
                type: string
                enum: [low, normal, high, critical]
                
        optimization:
          type: object
          description: Performance optimization settings
          properties:
            cache_enabled:
              type: boolean
              default: true
            batch_size:
              type: integer
              minimum: 1
            timeout_seconds:
              type: integer
              minimum: 1
            retry_policy:
              type: object
              properties:
                max_attempts:
                  type: integer
                  minimum: 1
                backoff_multiplier:
                  type: number
                  minimum: 1.0
                  
        monitoring:
          type: object
          description: Monitoring and observability configuration
          properties:
            metrics_enabled:
              type: boolean
              default: true
            log_level:
              type: string
              enum: [DEBUG, INFO, WARNING, ERROR, CRITICAL]
            trace_enabled:
              type: boolean
              default: false
              
        constraints:
          type: object
          description: Resource and policy constraints
          properties:
            max_tokens:
              type: integer
              minimum: 1
            max_cost_per_request:
              type: number
              minimum: 0
            allowed_models:
              type: array
              items:
                type: string
            requires_gpu:
              type: boolean
            privacy_mode:
              type: string
              enum: [public, private, local_only]

  # =====================================
  # COMPONENT DEFINITIONS
  # =====================================
  components:
    type: object
    description: Available components and their schemas
    properties:
      
      # =====================================  
      # COMPONENT SETUP PATTERNS
      # =====================================
      # Common setup patterns that can be referenced by components
      setup_patterns:
        type: object
        description: Reusable setup patterns for different component types
        properties:
          
          package_manager_install:
            type: object
            description: Standard package manager installation pattern
            properties:
              platforms:
                type: object
                properties:
                  darwin:
                    type: object
                    properties:
                      homebrew:
                        type: object
                        properties:
                          install_command:
                            type: string
                            pattern: "brew install {package_name}"
                          verify_command:
                            type: string
                            pattern: "brew list {package_name}"
                  linux:
                    type: object
                    properties:
                      apt:
                        type: object
                        properties:
                          install_command:
                            type: string
                            pattern: "sudo apt-get update && sudo apt-get install -y {package_name}"
                          verify_command:
                            type: string
                            pattern: "dpkg -l | grep {package_name}"
                      yum:
                        type: object
                        properties:
                          install_command:
                            type: string
                            pattern: "sudo yum install -y {package_name}"
                  windows:
                    type: object
                    properties:
                      chocolatey:
                        type: object
                        properties:
                          install_command:
                            type: string
                            pattern: "choco install {package_name} -y"
                          
          python_package_install:
            type: object
            description: Python package installation pattern
            properties:
              methods:
                type: object
                properties:
                  pip:
                    type: object
                    properties:
                      install_command:
                        type: string
                        pattern: "pip install {package_name}"
                      verify_command:
                        type: string
                        pattern: "pip show {package_name}"
                  uv:
                    type: object
                    properties:
                      install_command:
                        type: string
                        pattern: "uv add {package_name}"
                      verify_command:
                        type: string
                        pattern: "uv list | grep {package_name}"
                        
          build_from_source:
            type: object
            description: Build from source pattern
            properties:
              steps:
                type: array
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    command:
                      type: string
                    working_directory:
                      type: string
                    environment_vars:
                      type: object
                    timeout_minutes:
                      type: integer
                      default: 30
                      
          docker_install:
            type: object
            description: Docker-based installation pattern
            properties:
              image:
                type: string
              ports:
                type: array
                items:
                  type: string
              volumes:
                type: array
                items:
                  type: string
              environment:
                type: object
      
      # Cloud API Components
      cloud_apis:
        type: object
        description: Cloud-based model API providers
        properties:
          
          openai_compatible:
            type: object
            description: OpenAI-compatible API providers (OpenAI, Together, Groq, etc.)
            properties:
              schema:
                type: object
                properties:
                  provider:
                    type: string
                    description: Provider name
                    enum: [openai, together, anyscale, perplexity, groq, mistral, deepseek, grok, fireworks, openrouter, custom]
                  api_key:
                    type: string
                    description: API key for authentication
                  base_url:
                    type: string
                    description: Custom base URL for the API
                  default_model:
                    type: string
                    description: Default model to use
                  timeout:
                    type: integer
                    minimum: 1
                    default: 60
                  max_retries:
                    type: integer
                    minimum: 0
                    default: 3
                  organization:
                    type: string
                    description: Organization ID (OpenAI specific)
                required: [provider]
              capabilities:
                type: array
                items:
                  type: string
                  enum: [chat, completion, embeddings, function_calling, vision, streaming]
              providers:
                type: object
                description: Provider-specific configurations
                
      # Model App Components
      model_apps:
        type: object
        description: Local model serving applications
        properties:
          
          ollama:
            type: object
            description: Ollama local model server
            properties:
              schema:
                type: object
                properties:
                  base_url:
                    type: string
                    default: http://localhost:11434
                  default_model:
                    type: string
                    default: llama3.2:3b
                  auto_start:
                    type: boolean
                    default: true
                  models:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        pull_on_start:
                          type: boolean
                  gpu_layers:
                    type: integer
                    minimum: 0
                  num_thread:
                    type: integer
                    minimum: 1
              capabilities:
                type: array
                items:
                  type: string
                  enum: [chat, embeddings, model_management, quantization]
              # Setup and installation hooks
              setup:
                type: object
                description: Component setup and installation configuration
                properties:
                  installer:
                    type: object
                    description: Installation method and configuration
                    properties:
                      type:
                        type: string
                        enum: [binary, package_manager, docker, script, manual]
                        description: Installation method
                      platforms:
                        type: object
                        description: Platform-specific installation instructions
                        properties:
                          darwin:
                            type: object
                            properties:
                              method:
                                type: string
                                enum: [homebrew, download, script]
                              command:
                                type: string
                                description: Command to run for installation
                              url:
                                type: string
                                description: Download URL
                              verify_command:
                                type: string
                                description: Command to verify installation
                          linux:
                            type: object
                            properties:
                              method:
                                type: string
                                enum: [apt, yum, dnf, snap, download, script]
                              command:
                                type: string
                              url:
                                type: string
                              verify_command:
                                type: string
                          windows:
                            type: object
                            properties:
                              method:
                                type: string
                                enum: [chocolatey, winget, download, msi]
                              command:
                                type: string
                              url:
                                type: string
                              verify_command:
                                type: string
                  dependencies:
                    type: array
                    description: Required dependencies
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        type:
                          type: string
                          enum: [system, python, binary, service]
                        version:
                          type: string
                        optional:
                          type: boolean
                          default: false
                        install_command:
                          type: string
                  verification:
                    type: object
                    description: Methods to verify component is working
                    properties:
                      health_check:
                        type: object
                        properties:
                          command:
                            type: string
                            description: Command to check if component is healthy
                          expected_output:
                            type: string
                            description: Expected output pattern
                          timeout_seconds:
                            type: integer
                            default: 30
                      service_check:
                        type: object
                        properties:
                          url:
                            type: string
                            description: URL to check service availability
                          method:
                            type: string
                            enum: [GET, POST, HEAD]
                            default: GET
                          expected_status:
                            type: integer
                            default: 200
                  models:
                    type: object
                    description: Model download and management configuration
                    properties:
                      repository:
                        type: string
                        description: Default model repository
                      download_command:
                        type: string
                        description: Template command for downloading models
                      list_command:
                        type: string
                        description: Command to list installed models
                      remove_command:
                        type: string
                        description: Command to remove models
                      storage_location:
                        type: string
                        description: Where models are stored
                      size_estimation:
                        type: object
                        description: Model size estimation rules
                        properties:
                          rules:
                            type: array
                            items:
                              type: object
                              properties:
                                pattern:
                                  type: string
                                  description: Model name pattern (regex)
                                size_gb:
                                  type: number
                                  description: Estimated size in GB
                  error_handling:
                    type: object
                    description: Error handling and fallback configuration
                    properties:
                      installation_failures:
                        type: array
                        description: Actions to take on installation failure
                        items:
                          type: object
                          properties:
                            condition:
                              type: string
                              description: Error condition (regex)
                            action:
                              type: string
                              enum: [retry, fallback, manual, skip]
                            message:
                              type: string
                              description: User message for this error
                            fallback_installer:
                              type: string
                              description: Alternative installation method
                      service_failures:
                        type: array
                        description: Actions for service startup failures
                        items:
                          type: object
                          properties:
                            condition:
                              type: string
                            action:
                              type: string
                              enum: [restart, reconfigure, manual, skip]
                            retry_count:
                              type: integer
                              default: 3
                  
      # Fine-tuner Components  
      fine_tuners:
        type: object
        description: Model fine-tuning frameworks
        properties:
          
          pytorch:
            type: object
            description: PyTorch-based fine-tuning
            properties:
              schema:
                type: object
                properties:
                  # Hardware configuration - CRITICAL for cross-platform support
                  hardware:
                    type: object
                    description: Hardware-specific settings for optimal performance
                    properties:
                      device:
                        type: string
                        enum: [auto, cuda, mps, cpu]
                        default: auto
                        description: |
                          Device selection:
                          - auto: Automatically detect best available (recommended)
                          - cuda: NVIDIA GPU (Windows/Linux with CUDA)
                          - mps: Apple Silicon GPU (M1/M2/M3 Macs)
                          - cpu: CPU only (slowest but universal)
                      
                      memory_gb:
                        type: integer
                        minimum: 2
                        description: |
                          Available memory in GB:
                          - 4-8 GB: Use batch_size=1-2, gradient_checkpointing=true
                          - 8-16 GB: Use batch_size=2-4, standard settings
                          - 16+ GB: Use batch_size=4-8, can disable gradient_checkpointing
                      
                      precision:
                        type: object
                        description: Precision settings per hardware type
                        properties:
                          cuda:
                            type: object
                            properties:
                              use_fp16:
                                type: boolean
                                default: true
                                description: Use FP16 on CUDA (faster, less memory)
                              use_bf16:
                                type: boolean
                                default: false
                                description: Use BF16 if GPU supports it (A100, RTX 30xx+)
                              use_tf32:
                                type: boolean
                                default: true
                                description: Use TF32 on Ampere+ GPUs
                          mps:
                            type: object
                            properties:
                              use_fp16:
                                type: boolean
                                default: false
                                description: FP16 not well supported on MPS
                              use_bf16:
                                type: boolean
                                default: false
                                description: BF16 not supported on MPS
                          cpu:
                            type: object
                            properties:
                              use_fp16:
                                type: boolean
                                default: false
                                description: Keep FP32 on CPU for stability
                      
                      optimization:
                        type: object
                        description: Memory and speed optimizations
                        properties:
                          gradient_checkpointing:
                            type: boolean
                            default: true
                            description: |
                              Trade compute for memory:
                              - Enable for <8GB memory
                              - Disable for faster training with >16GB
                          gradient_accumulation_steps:
                            type: integer
                            minimum: 1
                            default: 1
                            description: |
                              Simulate larger batches:
                              - Use 4-8 for <8GB memory
                              - Use 1-2 for >16GB memory
                          mixed_precision:
                            type: string
                            enum: [no, fp16, bf16]
                            default: no
                            description: |
                              Mixed precision training:
                              - fp16: NVIDIA GPUs, saves memory
                              - bf16: Newer GPUs (A100, RTX 30xx+)
                              - no: CPU or compatibility mode
                  
                  base_model:
                    type: object
                    properties:
                      huggingface_id:
                        type: string
                      cache_dir:
                        type: string
                      torch_dtype:
                        type: string
                        enum: [auto, float32, float16, bfloat16]
                        description: |
                          Model loading precision:
                          - auto: Let PyTorch decide
                          - float32: Full precision (most memory)
                          - float16: Half precision (CUDA/MPS)
                          - bfloat16: Brain float (newer GPUs)
                  method:
                    type: object
                    properties:
                      type:
                        type: string
                        enum: [lora, qlora, full_finetune]
                      r:
                        type: integer
                        minimum: 1
                        maximum: 512
                      alpha:
                        type: integer
                        minimum: 1
                      dropout:
                        type: number
                        minimum: 0
                        maximum: 1
                  training:
                    type: object
                    properties:
                      batch_size:
                        type: integer
                        minimum: 1
                      learning_rate:
                        type: number
                        minimum: 0
                      num_epochs:
                        type: integer
                        minimum: 1
                      gradient_accumulation_steps:
                        type: integer
                        minimum: 1
                      warmup_ratio:
                        type: number
                        minimum: 0
                        maximum: 1
                      
          llamafactory:
            type: object
            description: LlamaFactory fine-tuning framework
            properties:
              schema:
                type: object
                properties:
                  model_name_or_path:
                    type: string
                  dataset:
                    type: string
                  template:
                    type: string
                  finetuning_type:
                    type: string
                    enum: [lora, qlora, full]
                  output_dir:
                    type: string
                    
      # Repository Components
      # Converter Components
      converters:
        type: object
        description: Model format converters
        properties:
          
          gguf:
            type: object
            description: GGUF format converter with llama.cpp
            properties:
              schema:
                type: object
                properties:
                  quantization:
                    type: string
                    enum: [q4_0, q4_1, q5_0, q5_1, q8_0, f16, f32]
                    default: q4_0
                    description: |
                      Quantization methods:
                      - q4_0: 4-bit, smallest size (~3-4GB for 7B model)
                      - q5_0: 5-bit, balanced (~4-5GB for 7B model)
                      - q8_0: 8-bit, good quality (~7GB for 7B model)
                      - f16: 16-bit, best quality (~13GB for 7B model)
                  auto_install:
                    type: boolean
                    default: true
                    description: Automatically install llama.cpp if not found
                  build_options:
                    type: object
                    properties:
                      metal:
                        type: boolean
                        description: Enable Metal on macOS
                      cuda:
                        type: boolean
                        description: Enable CUDA on Linux/Windows
                      rocm:
                        type: boolean
                        description: Enable ROCm for AMD GPUs
              capabilities:
                type: array
                items:
                  type: string
                  enum: [pytorch_to_gguf, lora_merge, quantization, ollama_export]
              # Setup configuration for GGUF converter
              setup:
                type: object
                description: Setup configuration for llama.cpp based conversion
                properties:
                  installer:
                    type: object
                    properties:
                      type:
                        type: string
                        enum: [build_from_source, binary, script]
                        default: build_from_source
                      platforms:
                        type: object
                        properties:
                          darwin:
                            type: object
                            properties:
                              method:
                                type: string
                                enum: [build, homebrew]
                                default: build
                              build_options:
                                type: array
                                items:
                                  type: string
                                default: [LLAMA_METAL=1]
                              repository:
                                type: string
                                default: https://github.com/ggerganov/llama.cpp
                              verify_command:
                                type: string
                                default: ./convert.py --help
                          linux:
                            type: object
                            properties:
                              method:
                                type: string
                                enum: [build, package]
                                default: build
                              build_options:
                                type: array
                                items:
                                  type: string
                                default: [LLAMA_CUDA=1]
                              repository:
                                type: string
                                default: https://github.com/ggerganov/llama.cpp
                              verify_command:
                                type: string
                                default: ./convert.py --help
                  dependencies:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        type:
                          type: string
                          enum: [system, python]
                    default:
                      - name: git
                        type: system
                      - name: make
                        type: system
                      - name: gcc
                        type: system
                      - name: torch
                        type: python
                      - name: numpy
                        type: python
                  error_handling:
                    type: object
                    properties:
                      build_failures:
                        type: array
                        items:
                          type: object
                          properties:
                            condition:
                              type: string
                            action:
                              type: string
                              enum: [retry_with_different_options, fallback_to_cpu, manual]
                            message:
                              type: string
          
          ollama:
            type: object
            description: Ollama model converter
            properties:
              schema:
                type: object
                properties:
                  quantization:
                    type: string
                    enum: [q4_0, q4_1, q5_0, q5_1, q8_0]
                    default: q4_0
                  system_prompt:
                    type: string
                    description: System prompt for the model
                  push_to_registry:
                    type: boolean
                    default: false
                    description: Push to Ollama registry after creation
              capabilities:
                type: array
                items:
                  type: string
                  enum: [gguf_to_ollama, pytorch_to_ollama, model_management]
      
      repositories:
        type: object
        description: Model repository integrations
        properties:
          
          huggingface:
            type: object
            description: HuggingFace Hub integration
            properties:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: HuggingFace API token
                  cache_dir:
                    type: string
                    description: Local cache directory
                  repo_id:
                    type: string
                    description: Repository identifier
                  private:
                    type: boolean
                    default: false

      # =====================================
      # IMAGE RECOGNITION COMPONENTS
      # =====================================
      image_recognizers:
        type: object
        description: Image recognition and computer vision components
        properties:
          
          yolo:
            type: object
            description: YOLO (You Only Look Once) object detection framework
            properties:
              schema:
                type: object
                properties:
                  model:
                    type: string
                    description: YOLO model variant to use
                    enum: [
                      yolov8n.pt, yolov8s.pt, yolov8m.pt, yolov8l.pt, yolov8x.pt,
                      yolov8n-cls.pt, yolov8s-cls.pt, yolov8m-cls.pt,
                      yolov8n-seg.pt, yolov8s-seg.pt, yolov8m-seg.pt,
                      yolov9c.pt, yolov9e.pt, yolov10n.pt, yolov10s.pt,
                      yolo11n.pt, yolo11s.pt, yolo11m.pt, yolo11l.pt, yolo11x.pt
                    ]
                    default: yolov8n.pt
                  device:
                    type: string
                    enum: [auto, cpu, cuda, mps]
                    default: auto
                    description: |
                      Compute device selection:
                      - auto: Automatically detect best available (recommended)
                      - cpu: CPU only (universal but slower)
                      - cuda: NVIDIA GPU acceleration
                      - mps: Apple Silicon GPU acceleration (M1/M2/M3/M4)
                  confidence:
                    type: number
                    minimum: 0.0
                    maximum: 1.0
                    default: 0.5
                    description: Minimum confidence threshold for detections
                  nms_threshold:
                    type: number
                    minimum: 0.0
                    maximum: 1.0
                    default: 0.45
                    description: Non-Maximum Suppression threshold
                  max_detections:
                    type: integer
                    minimum: 1
                    maximum: 1000
                    default: 100
                    description: Maximum number of detections per image
                  input_size:
                    type: integer
                    enum: [320, 416, 512, 640, 832, 1024, 1280]
                    default: 640
                    description: Input image size (affects speed vs accuracy)
                  half_precision:
                    type: boolean
                    default: false
                    description: Use FP16 for faster inference (GPU only)
                  batch_size:
                    type: integer
                    minimum: 1
                    maximum: 32
                    default: 1
                    description: Number of images to process in parallel
                  cache_images:
                    type: boolean
                    default: false
                    description: Cache preprocessed images for faster repeated inference
                  classes:
                    type: array
                    items:
                      type: integer
                    description: Filter detections to specific class IDs (optional)
                  agnostic_nms:
                    type: boolean
                    default: false
                    description: Class-agnostic Non-Maximum Suppression
                  augment:
                    type: boolean
                    default: false
                    description: Use test-time augmentation for better accuracy
                  retina_masks:
                    type: boolean
                    default: false
                    description: Use high-resolution masks (segmentation models only)
                  
              capabilities:
                type: array
                items:
                  type: string
                  enum: [
                    object_detection, classification, segmentation, tracking,
                    pose_estimation, face_detection, text_detection,
                    batch_processing, real_time, export_formats
                  ]
                default: [object_detection, batch_processing, export_formats]
                
              # YOLO setup configuration
              setup:
                type: object
                description: YOLO installation and setup configuration
                properties:
                  installer:
                    type: object
                    properties:
                      type:
                        type: string
                        enum: [python_package, conda, docker]
                        default: python_package
                      platforms:
                        type: object
                        properties:
                          all:
                            type: object
                            properties:
                              method:
                                type: string
                                enum: [pip, uv, conda, poetry]
                                default: pip
                              package_name:
                                type: string
                                default: ultralytics
                              version:
                                type: string
                                default: ">=8.0.0"
                              install_command:
                                type: string
                                default: "pip install ultralytics>=8.0.0"
                              verify_command:
                                type: string
                                default: "python -c 'from ultralytics import YOLO; print(YOLO.__version__)'"
                  dependencies:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        type:
                          type: string
                          enum: [python, system]
                        version:
                          type: string
                        optional:
                          type: boolean
                    default:
                      - name: torch
                        type: python
                        version: ">=1.8.0"
                      - name: torchvision
                        type: python
                        version: ">=0.9.0"
                      - name: opencv-python
                        type: python
                        version: ">=4.5.0"
                      - name: pillow
                        type: python
                        version: ">=8.0.0"
                      - name: numpy
                        type: python
                        version: ">=1.18.0"
                      - name: pandas
                        type: python
                        version: ">=1.1.0"
                        optional: true
                      - name: matplotlib
                        type: python
                        version: ">=3.3.0"
                        optional: true
                  models:
                    type: object
                    properties:
                      repository:
                        type: string
                        default: "https://github.com/ultralytics/assets/releases/download"
                      download_command:
                        type: string
                        default: "yolo task=detect mode=predict model={model_name}"
                      auto_download:
                        type: boolean
                        default: true
                        description: Automatically download models on first use
                      cache_location:
                        type: string
                        default: "~/.cache/ultralytics"
                        description: Directory to cache downloaded models
                      size_estimates:
                        type: object
                        description: Model size estimates in MB
                        properties:
                          yolov8n.pt:
                            type: number
                            default: 6.2
                          yolov8s.pt:
                            type: number
                            default: 21.5
                          yolov8m.pt:
                            type: number
                            default: 49.7
                          yolov8l.pt:
                            type: number
                            default: 83.7
                          yolov8x.pt:
                            type: number
                            default: 130.5
                  verification:
                    type: object
                    properties:
                      quick_test:
                        type: object
                        properties:
                          command:
                            type: string
                            default: "python -c 'from ultralytics import YOLO; model = YOLO(\"yolov8n.pt\"); print(\"YOLO ready\")'"
                          timeout_seconds:
                            type: integer
                            default: 60
                      performance_test:
                        type: object
                        properties:
                          command:
                            type: string
                            default: "yolo predict model=yolov8n.pt source=ultralytics/assets/bus.jpg"
                          expected_objects:
                            type: array
                            items:
                              type: string
                            default: [person, bus]
                  
          opencv:
            type: object
            description: OpenCV computer vision library integration
            properties:
              schema:
                type: object
                properties:
                  backend:
                    type: string
                    enum: [opencv, opencv-contrib]
                    default: opencv
                  dnn_backend:
                    type: string
                    enum: [default, opencv, openvino, cuda, tensorrt]
                    default: default
                  cascade_path:
                    type: string
                    description: Path to Haar cascade files
                  model_path:
                    type: string
                    description: Path to pre-trained models
              capabilities:
                type: array
                items:
                  type: string
                  enum: [
                    image_processing, video_processing, face_detection,
                    feature_detection, optical_flow, stereo_vision,
                    dnn_inference, gpu_acceleration
                  ]
                  
          tensorflow:
            type: object
            description: TensorFlow-based image recognition
            properties:
              schema:
                type: object
                properties:
                  model_format:
                    type: string
                    enum: [savedmodel, h5, tflite, tfjs]
                    default: savedmodel
                  model_path:
                    type: string
                  input_shape:
                    type: array
                    items:
                      type: integer
                    default: [224, 224, 3]
                  preprocessing:
                    type: object
                    properties:
                      normalize:
                        type: boolean
                        default: true
                      mean:
                        type: array
                        items:
                          type: number
                        default: [0.485, 0.456, 0.406]
                      std:
                        type: array
                        items:
                          type: number
                        default: [0.229, 0.224, 0.225]
              capabilities:
                type: array
                items:
                  type: string
                  enum: [
                    classification, object_detection, segmentation,
                    transfer_learning, quantization, edge_deployment
                  ]
                  
      # =====================================
      # IMAGE TRAINING COMPONENTS
      # =====================================
      image_trainers:
        type: object
        description: Image model training and fine-tuning components
        properties:
          
          yolo_trainer:
            type: object
            description: YOLO model training and fine-tuning
            properties:
              schema:
                type: object
                properties:
                  base_model:
                    type: string
                    enum: [
                      yolov8n.pt, yolov8s.pt, yolov8m.pt, yolov8l.pt, yolov8x.pt,
                      yolov9c.pt, yolov9e.pt, yolov10n.pt, yolov10s.pt,
                      yolo11n.pt, yolo11s.pt, yolo11m.pt, yolo11l.pt, yolo11x.pt
                    ]
                    default: yolov8n.pt
                  dataset_format:
                    type: string
                    enum: [yolo, coco, voc, custom]
                    default: yolo
                  dataset_path:
                    type: string
                    description: Path to training dataset
                  epochs:
                    type: integer
                    minimum: 1
                    maximum: 1000
                    default: 100
                  batch_size:
                    type: integer
                    minimum: 1
                    maximum: 64
                    default: 16
                  image_size:
                    type: integer
                    enum: [320, 416, 512, 640, 832, 1024, 1280]
                    default: 640
                  learning_rate:
                    type: number
                    minimum: 0.0001
                    maximum: 1.0
                    default: 0.01
                  momentum:
                    type: number
                    minimum: 0.0
                    maximum: 1.0
                    default: 0.937
                  weight_decay:
                    type: number
                    minimum: 0.0
                    maximum: 1.0
                    default: 0.0005
                  augmentation:
                    type: object
                    properties:
                      enabled:
                        type: boolean
                        default: true
                      hsv_h:
                        type: number
                        default: 0.015
                      hsv_s:
                        type: number
                        default: 0.7
                      hsv_v:
                        type: number
                        default: 0.4
                      degrees:
                        type: number
                        default: 0.0
                      translate:
                        type: number
                        default: 0.1
                      scale:
                        type: number
                        default: 0.5
                      shear:
                        type: number
                        default: 0.0
                      perspective:
                        type: number
                        default: 0.0
                      flipud:
                        type: number
                        default: 0.0
                      fliplr:
                        type: number
                        default: 0.5
                      mosaic:
                        type: number
                        default: 1.0
                      mixup:
                        type: number
                        default: 0.0
                      copy_paste:
                        type: number
                        default: 0.0
                  validation:
                    type: object
                    properties:
                      split:
                        type: number
                        minimum: 0.0
                        maximum: 1.0
                        default: 0.2
                      patience:
                        type: integer
                        minimum: 1
                        default: 50
                      save_best:
                        type: boolean
                        default: true
                  device:
                    type: string
                    enum: [auto, cpu, cuda, mps]
                    default: auto
                  workers:
                    type: integer
                    minimum: 0
                    maximum: 32
                    default: 8
                  project:
                    type: string
                    description: Project name for saving results
                  name:
                    type: string
                    description: Experiment name
                  exist_ok:
                    type: boolean
                    default: false
                    description: Whether to overwrite existing project
                  pretrained:
                    type: boolean
                    default: true
                    description: Use pretrained weights
                  optimizer:
                    type: string
                    enum: [SGD, Adam, AdamW, NAdam, RAdam, RMSProp]
                    default: auto
                  verbose:
                    type: boolean
                    default: true
                  seed:
                    type: integer
                    default: 0
                  deterministic:
                    type: boolean
                    default: true
                  single_cls:
                    type: boolean
                    default: false
                    description: Train as single-class dataset
                  rect:
                    type: boolean
                    default: false
                    description: Rectangular training
                  cos_lr:
                    type: boolean
                    default: false
                    description: Cosine learning rate scheduler
                  close_mosaic:
                    type: integer
                    default: 10
                    description: Disable mosaic augmentation for final epochs
                  resume:
                    type: boolean
                    default: false
                    description: Resume training from last checkpoint
                  amp:
                    type: boolean
                    default: true
                    description: Automatic Mixed Precision training
                  fraction:
                    type: number
                    minimum: 0.0
                    maximum: 1.0
                    default: 1.0
                    description: Fraction of dataset to use for training
                  profile:
                    type: boolean
                    default: false
                    description: Profile ONNX and TensorRT speeds
                  freeze:
                    type: array
                    items:
                      type: integer
                    description: Layer indices to freeze during training
                    
              capabilities:
                type: array
                items:
                  type: string
                  enum: [
                    object_detection_training, classification_training,
                    segmentation_training, transfer_learning, few_shot_learning,
                    data_augmentation, model_pruning, quantization_aware_training,
                    hyperparameter_tuning, distributed_training
                  ]
                  
          few_shot_trainer:
            type: object
            description: Few-shot learning for image recognition
            properties:
              schema:
                type: object
                properties:
                  base_model:
                    type: string
                    description: Pre-trained model to fine-tune
                  support_shots:
                    type: integer
                    minimum: 1
                    maximum: 50
                    default: 5
                    description: Number of examples per class
                  query_shots:
                    type: integer
                    minimum: 1
                    default: 5
                    description: Number of query examples per class
                  meta_learning_rate:
                    type: number
                    default: 0.001
                  inner_learning_rate:
                    type: number
                    default: 0.01
                  meta_batch_size:
                    type: integer
                    default: 4
                  adaptation_steps:
                    type: integer
                    default: 5
                  algorithm:
                    type: string
                    enum: [maml, prototypical, matching, relation]
                    default: prototypical
              capabilities:
                type: array
                items:
                  type: string
                  enum: [few_shot_detection, few_shot_classification, meta_learning]

  # =====================================
  # STRATEGY TEMPLATES
  # =====================================
  strategy_templates:
    type: object
    description: Pre-defined strategy templates for common use cases
    properties:
      
      local_development:
        type: object
        description: Optimized for local development with Ollama
        
      cloud_production:
        type: object
        description: Production deployment with cloud APIs
        
      hybrid_fallback:
        type: object
        description: Cloud primary with local fallback
        
      fine_tuning_pipeline:
        type: object
        description: Complete fine-tuning workflow
        
      multi_provider:
        type: object
        description: Load-balanced multi-provider setup
        
      cost_optimized:
        type: object
        description: Minimize costs while maintaining quality
        
      privacy_first:
        type: object
        description: Local-only processing for sensitive data
        
      research_experimentation:
        type: object
        description: Flexible setup for model research
        
      # =====================================
      # IMAGE RECOGNITION STRATEGY TEMPLATES
      # =====================================
      object_detection_pipeline:
        type: object
        description: Complete object detection workflow with YOLO
        properties:
          components:
            type: object
            properties:
              image_recognizer:
                type: object
                properties:
                  type:
                    type: string
                    default: yolo
                  config:
                    type: object
                    properties:
                      model:
                        type: string
                        default: yolov8n.pt
                      device:
                        type: string
                        default: auto
                      confidence:
                        type: number
                        default: 0.5
          detection_params:
            type: object
            properties:
              confidence:
                type: number
                default: 0.5
              nms_threshold:
                type: number
                default: 0.45
          visualization:
            type: object
            properties:
              show_labels:
                type: boolean
                default: true
              show_confidence:
                type: boolean
                default: true
        
      real_time_vision_processing:
        type: object
        description: Real-time video processing and object tracking
        properties:
          components:
            type: object
            properties:
              image_recognizer:
                type: object
                properties:
                  type:
                    type: string
                    default: yolo
                  config:
                    type: object
                    properties:
                      model:
                        type: string
                        default: yolov8s.pt
                      device:
                        type: string
                        default: auto
                      half_precision:
                        type: boolean
                        default: true
          optimization:
            type: object
            properties:
              batch_size:
                type: integer
                default: 4
              cache_images:
                type: boolean
                default: true
        
      edge_device_vision:
        type: object
        description: Optimized for mobile and edge devices
        properties:
          components:
            type: object
            properties:
              image_recognizer:
                type: object
                properties:
                  type:
                    type: string
                    default: yolo
                  config:
                    type: object
                    properties:
                      model:
                        type: string
                        default: yolov8n.pt
                      device:
                        type: string
                        default: cpu
                      input_size:
                        type: integer
                        default: 320
          constraints:
            type: object
            properties:
              max_memory_mb:
                type: integer
                default: 512
              max_inference_time_ms:
                type: integer
                default: 100
        
      industrial_quality_control:
        type: object
        description: High-precision defect detection for manufacturing
        properties:
          components:
            type: object
            properties:
              image_recognizer:
                type: object
                properties:
                  type:
                    type: string
                    default: yolo
                  config:
                    type: object
                    properties:
                      model:
                        type: string
                        default: yolov8l.pt
                      confidence:
                        type: number
                        default: 0.3
                      input_size:
                        type: integer
                        default: 1024
              image_trainer:
                type: object
                properties:
                  type:
                    type: string
                    default: yolo_trainer
                  config:
                    type: object
                    properties:
                      epochs:
                        type: integer
                        default: 200
                      patience:
                        type: integer
                        default: 50
          monitoring:
            type: object
            properties:
              track_accuracy:
                type: boolean
                default: true
              alert_threshold:
                type: number
                default: 0.95
        
      medical_image_analysis:
        type: object
        description: Medical imaging with regulatory compliance
        properties:
          components:
            type: object
            properties:
              image_recognizer:
                type: object
                properties:
                  type:
                    type: string
                    default: tensorflow
                  config:
                    type: object
                    properties:
                      model_format:
                        type: string
                        default: savedmodel
                      preprocessing:
                        type: object
                        properties:
                          normalize:
                            type: boolean
                            default: true
          constraints:
            type: object
            properties:
              privacy_mode:
                type: string
                default: local_only
              audit_logging:
                type: boolean
                default: true
              hipaa_compliant:
                type: boolean
                default: true
        
      content_moderation_system:
        type: object
        description: Automated content filtering and classification
        properties:
          components:
            type: object
            properties:
              image_recognizer:
                type: object
                properties:
                  type:
                    type: string
                    default: tensorflow
                  config:
                    type: object
                    properties:
                      model_path:
                        type: string
                        default: "./models/content_classifier"
          fallback_chain:
            type: array
            items:
              type: object
              properties:
                provider:
                  type: string
                model:
                  type: string
                confidence_threshold:
                  type: number
          monitoring:
            type: object
            properties:
              false_positive_tracking:
                type: boolean
                default: true
              human_review_threshold:
                type: number
                default: 0.7

  # =====================================
  # USE CASE MAPPINGS
  # =====================================
  use_case_mapping:
    type: object
    description: Maps use cases to recommended strategies
    properties:
      
      chatbot:
        type: array
        items:
          type: string
        default: [hybrid_fallback, cloud_production]
        
      code_generation:
        type: array
        items:
          type: string
        default: [cloud_production, specialized_models]
        
      document_analysis:
        type: array
        items:
          type: string
        default: [local_development, privacy_first]
        
      creative_writing:
        type: array
        items:
          type: string
        default: [cloud_production, fine_tuned_models]
        
      translation:
        type: array
        items:
          type: string
        default: [multi_lingual, cloud_production]
        
      summarization:
        type: array
        items:
          type: string
        default: [cost_optimized, hybrid_fallback]
        
      # =====================================
      # IMAGE RECOGNITION USE CASES
      # =====================================
      object_detection:
        type: array
        items:
          type: string
        default: [image_yolo_default, image_yolo_performance, image_yolo_accuracy]
        description: Detect and locate objects in images
        
      image_classification:
        type: array
        items:
          type: string
        default: [image_yolo_classification, tensorflow_classifier]
        description: Categorize images into predefined classes
        
      image_segmentation:
        type: array
        items:
          type: string
        default: [image_yolo_segmentation, tensorflow_segmentation]
        description: Pixel-level object detection and segmentation
        
      real_time_vision:
        type: array
        items:
          type: string
        default: [image_yolo_performance, image_apple_silicon_optimized, image_cuda_optimized]
        description: Real-time image processing for video streams
        
      mobile_vision:
        type: array
        items:
          type: string
        default: [image_yolo_mobile, image_cpu_optimized]
        description: Image recognition on mobile and edge devices
        
      batch_image_processing:
        type: array
        items:
          type: string
        default: [image_yolo_performance, image_cuda_optimized]
        description: Process large batches of images efficiently
        
      face_detection:
        type: array
        items:
          type: string
        default: [opencv_face_detector, yolo_face_detector]
        description: Detect faces in images
        
      document_analysis:
        type: array
        items:
          type: string
        default: [opencv_document_scanner, tensorflow_ocr]
        description: Analyze and extract information from documents
        
      medical_imaging:
        type: array
        items:
          type: string
        default: [tensorflow_medical, pytorch_medical]
        description: Medical image analysis and diagnosis
        
      security_surveillance:
        type: array
        items:
          type: string
        default: [image_yolo_performance, real_time_tracker]
        description: Security and surveillance applications
        
      autonomous_vehicles:
        type: array
        items:
          type: string
        default: [image_yolo_accuracy, multi_camera_fusion]
        description: Computer vision for autonomous driving
        
      industrial_inspection:
        type: array
        items:
          type: string
        default: [high_precision_detector, defect_classifier]
        description: Quality control and defect detection
        
      retail_analytics:
        type: array
        items:
          type: string
        default: [product_recognizer, people_counter]
        description: Retail customer and product analytics
        
      content_moderation:
        type: array
        items:
          type: string
        default: [nsfw_classifier, content_analyzer]
        description: Automated content moderation and filtering

  # =====================================
  # VALIDATION RULES
  # =====================================
  validation_rules:
    type: object
    description: System-wide validation constraints
    properties:
      
      required_components:
        type: array
        description: Components required for valid configuration
        items:
          type: string
          
      incompatible_combinations:
        type: array
        description: Component combinations that are not allowed
        items:
          type: object
          properties:
            components:
              type: array
              items:
                type: string
            reason:
              type: string
        default:
          - components: [image_recognizer, fine_tuner]
            reason: Image recognition and LLM fine-tuning serve different purposes
          - components: [yolo, tensorflow]
            reason: Multiple image recognition frameworks in same strategy not recommended
          - components: [image_trainer, cloud_api]
            reason: Image training typically requires local compute resources
              
      performance_thresholds:
        type: object
        properties:
          max_latency_ms:
            type: integer
            minimum: 1
          min_throughput_rps:
            type: number
            minimum: 0
          max_error_rate:
            type: number
            minimum: 0
            maximum: 1

  # =====================================
  # METADATA
  # =====================================
  metadata:
    type: object
    description: Schema metadata and versioning
    properties:
      version:
        type: string
        pattern: ^\d+\.\d+\.\d+$
      last_updated:
        type: string
        format: date-time
      maintainers:
        type: array
        items:
          type: string
      documentation_url:
        type: string
        format: uri

# Required top-level properties
required: [strategies, components]

# Additional schema constraints
additionalProperties: false